#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

# Load optional .env.local file
if [ -f .env.local ]; then
  export $(grep -v '^#' .env.local | xargs)
fi

# Conditionally skip hooks
if [ "$SKIP_HOOKS" = "true" ]; then
  echo "ğŸ” SKIP_HOOKS is true â€” skipping pre-commit checks"
  exit 0
fi

# Helper function to prompt user
prompt_continue() {
  echo "âš ï¸  Do you want to continue anyway? [y/N]"
  read answer
  case "$answer" in
    [Yy]* ) echo "â¡ï¸  Continuing to next step...";;
    * ) echo "ğŸ›‘ Commit aborted."; exit 1;;
  esac
}

echo "ğŸ›¡ï¸  Starting pre-commit checks..."

# Step 1: Linting
echo "ğŸ§¹ Step 1: Linting..."
if pnpm lint; then
  echo "âœ… Lint passed!"
else
  echo "âŒ Lint failed."
  prompt_continue
fi

# Step 2: Format check
echo "ğŸ¨ Step 2: Format check..."
if pnpm format:check; then
  echo "âœ… Format check passed!"
else
  echo "âŒ Format check failed."
  prompt_continue
fi

# Step 3: Testing
echo "ğŸ§ª Step 3: Running tests..."
if pnpm test; then
  echo "âœ… All tests passed!"
else
  echo "âŒ Tests failed."
  prompt_continue
fi

echo "ğŸ‰ All pre-commit checks completed â€” proceeding with commit!"
