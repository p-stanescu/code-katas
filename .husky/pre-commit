#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

# Load optional .env.local file
if [ -f .env.local ]; then
  export $(grep -v '^#' .env.local | xargs)
fi

# Conditionally skip hooks
if [ "$SKIP_HOOKS" = "true" ]; then
  echo "ğŸ” SKIP_HOOKS is true â€” skipping pre-commit checks"
  exit 0
fi

echo "ğŸ›¡ï¸  Starting pre-commit checks..."

# Step 1: Linting
echo "ğŸ§¹ Step 1: Linting..."
pnpm lint || exit_code=$?
if [ "$exit_code" ]; then
  echo "âŒ Lint failed."
  exit 1
fi
echo "âœ… Lint passed!"

# Step 2: Type Checking
echo "ğŸ“ Step 2: Type checking..."
pnpm typecheck || exit_code=$?
if [ "$exit_code" ]; then
  echo "âŒ Type check failed."
  exit 1
fi
echo "âœ… Type check passed!"

# Step 3: Format Check
echo "ğŸ¨ Step 3: Format check..."
pnpm format:check || exit_code=$?
if [ "$exit_code" ]; then
  echo "âŒ Format check failed."
  exit 1
fi
echo "âœ… Format check passed!"

# Step 4: Tests
echo "ğŸ§ª Step 4: Running tests..."
pnpm test || exit_code=$?
if [ "$exit_code" ]; then
  echo "âŒ Tests failed."
  exit 1
fi
echo "âœ… All tests passed!"

echo "ğŸ‰ All checks completed â€” commit ready!"
exit 0
